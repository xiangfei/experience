## tcp 3次握手

 
[参考](https://blog.csdn.net/qq_40337086/article/details/112443124)


### 简单流程

TCP三次握手是浏览器和服务器建立连接的方式，目的是为了使二者能够建立连接，便于后续的数据交互传输。

- 第一次握手：浏览器向服务器发起建立连接的请求
- 第二次握手：服务器告诉浏览器，我同意你的连接请求，同时我也向你发起建立连接的请求
- 第三次握手：浏览器也告诉服务器，我同意建立连接。

至此，双方都知道对方同意建立连接，并准备好了进行数据传输，也知道对方知道自己的情况。接下来就可以传输数据了

简单示意图

- 一次握手：客户端发送带有 SYN 标志的连接请求数据包给服务端
- 二次握手：服务端发送带有 SYN+ACK 标志的连接请求和应答数据包给客户端
- 三次握手：客户端发送带有 ACK 标志的应答数据包给服务端(可以携带数据了)

![normal](/images/tcp_3_short.png)




### 流程分析

![normal](/images/tcp_3.png)

- 0.初始状态：
  - 服务端监听某个端口，处于 LISTEN 状态。

- 1.客户端发送TCP连接请求
  - 客户端会随机一个初始序列号seq=x（client_isn），
设置SYN=1 ，表示这是SYN握手报文。然后就可以把这个 SYN 报文发送给服务端了，表示向服务端发起连接，之后客户端处于 同步已发送 状态。

- 2.服务端发送针对TCP连接请求的确认
  - 服务端收到客户端的 SYN 报文后，也随机一个初始序列号（server_isn）(seq=y)
设置ack=x+1, 表示收到了客户端的x之前的数据，希望客户端下次发送的数据从x+1开始。
设置 SYN=1 和 ACK=1。表示这是一个SYN握手和ACK确认应答报文。
最后把该报文发给客户端，该报文也不包含应用层数据，之后服务端处于 同步已接收 状态。

- 3.客户端发送确认的确认
  - 客户端收到服务端报文后，还要向服务端回应最后一个应答报文，
将ACK置为 1 ，表示这是一个应答报文
ack=y+1 ，表示收到了服务器的y之前的数据，希望服务器下次发送的数据从y+1开始。
最后把报文发送给服务端，这次报文可以携带数据，之后客户端处于 连接已建立 状态。
服务器收到客户端的应答报文后，也进入连接已建立 状态









