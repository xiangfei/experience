# tcp  攻击


## SYNC 攻击




![sync](/images/tcp_3_sync.png)


- 服务端接收到客户端的 SYN 报文时，会将其加入到内核的「 SYN 队列」；

- 接着发送 SYN + ACK 给客户端，等待客户端回应 ACK 报文；

- 服务端接收到 ACK 报文后，从「 SYN 队列」移入到「 Accept 队列」；


![sync](/images/tcp_3_sync_attack.png)


### 如何防止SYN 攻击？
1. 限制ip连接次数：比如限制同一IP一分钟内新建立的连接数仅为10

2. 增大半连接状态的连接数容量
但是增大内存资源占用，不推荐。

3. 延迟分配连接资源
当服务器收到第一次握手请求时，不马上分配TCP连接资源。而是计算一个随机值，在第二次握手时传给客户端，当客户端返回第三次握手时，服务器验证随机值的正确性，确认无误才会进入 TCP 的连接状态，才会分配资源。


> [!TIP]如果是恶意攻击者发送的大量SYN报文，只要服务器不为其分配资源，也不至于遭到严重破坏了。





## RST 攻击


- 用来异常的关闭连接。在发送RST包关闭连接时，不必等缓冲区的包都发出去，而是直接丢弃缓存区的包发送RST包。而接收端收到RST包后，也不必发送ACK包来确认。

- RST攻击：客户端和服务端之间建立了TCP连接。此时攻击者伪造了一个TCP包发给客户端，使客户端异常的断开了与服务端之间的TCP连接，这就是RST攻击。

## 会话劫持

- TCP使用端到端连接，即用源IP地址，源TCP端口号，目的IP地址，目的TCP端号来唯一标识已经建立连接的TCP链路。而TCP在进行数据传输时，其***（seq）和确认序号（ack）有关。TCP会话劫持是在通信双方已建立的TCP会话连接的基础上假冒其中一方（一般为客户端是客户端）的身份与另外一方（服务端）进行通信，从而达到劫持双方通讯信息的目的